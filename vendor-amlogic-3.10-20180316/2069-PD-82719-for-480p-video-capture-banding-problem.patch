From 0597aaba91aeac2af0881c5adf5a71530cca09a2 Mon Sep 17 00:00:00 2001
From: "zhenfei.li" <zhenfei.li@amlogic>
Date: Wed, 20 Nov 2013 13:45:59 +0800
Subject: [PATCH 2069/5965] PD #82719: for 480p video capture banding problem.

---
 drivers/amlogic/camera/ov5640.c | 98 ++++++++++++++++++++++++++++-----
 1 file changed, 85 insertions(+), 13 deletions(-)

diff --git a/drivers/amlogic/camera/ov5640.c b/drivers/amlogic/camera/ov5640.c
index b5e5f51daa39..22a00605b90f 100755
--- a/drivers/amlogic/camera/ov5640.c
+++ b/drivers/amlogic/camera/ov5640.c
@@ -922,15 +922,63 @@ static struct aml_camera_i2c_fig_s OV5640_script[] = {
 };
 
 static struct aml_camera_i2c_fig_s OV5640_preview_VGA_script[] = {
-	{0x3503, 0x00},
+	#if 1
+	{0x3103, 0x03},
+	{0x3017, 0xff},
+	{0x3018, 0xff},
+	{0x3034, 0x1a},
 	{0x3035, 0x11},
 	{0x3036, 0x46},
+	{0x3037, 0x13},
+	{0x3108, 0x01},
+	{0x3630, 0x36},
+	{0x3631, 0x0e},
+	{0x3632, 0xe2},
+	{0x3633, 0x12},
+	{0x3621, 0xe0},
+	{0x3704, 0xa0},
+	{0x3703, 0x5a},
+	{0x3715, 0x78},
+	{0x3717, 0x01},
+	{0x370b, 0x60},
+	{0x3705, 0x1a},
+	{0x3905, 0x02},
+	{0x3906, 0x10},
+	{0x3901, 0x0a},
+	{0x3731, 0x12},
+	{0x3600, 0x08},
+	{0x3601, 0x33},
+	{0x302d, 0x60},
+	{0x3620, 0x52},
+	{0x371b, 0x20},
+	{0x471c, 0x50},
+	{0x3a13, 0x43},
+	{0x3a18, 0x00},
+	{0x3a19, 0x80},
+	{0x3635, 0x13},
+	{0x3636, 0x03},
+	{0x3634, 0x40},
+	{0x3622, 0x01},
+	{0x3c01, 0x34},
+	{0x3c04, 0x28},
+	{0x3c05, 0x98},
+	{0x3c06, 0x00},
 	{0x3c07, 0x08},
-	{0x3820, 0x41}, // #3 ck. origin: 0x41,
-	{0x3821, 0x07}, // #3 ck. origin: 0x07
+	{0x3c08, 0x00},
+	{0x3c09, 0x1c},
+	{0x3c0a, 0x9c},
+	{0x3c0b, 0x40},
+	{0x3820, 0x41},
+	{0x3821, 0x07},
 	{0x3814, 0x31},
 	{0x3815, 0x31},
+	{0x3800, 0x00},
+	{0x3801, 0x00},
+	{0x3802, 0x00},
 	{0x3803, 0x04},
+	{0x3804, 0x0a},
+	{0x3805, 0x3f},
+	{0x3806, 0x07},
 	{0x3807, 0x9b},
 	{0x3808, 0x02},
 	{0x3809, 0x80},
@@ -940,32 +988,54 @@ static struct aml_camera_i2c_fig_s OV5640_preview_VGA_script[] = {
 	{0x380d, 0x68},
 	{0x380e, 0x03},
 	{0x380f, 0xd8},
+	{0x3810, 0x00},
+	{0x3811, 0x10},
+	{0x3812, 0x00},
 	{0x3813, 0x06},
 	{0x3618, 0x00},
 	{0x3612, 0x29},
-	{0x3708, 0x62},
+	{0x3708, 0x64},
 	{0x3709, 0x52},
 	{0x370c, 0x03},
 	{0x3a02, 0x03},
 	{0x3a03, 0xd8},
+	{0x3a08, 0x01},
+	{0x3a09, 0x27},
+	{0x3a0a, 0x00},
+	{0x3a0b, 0xf6},
 	{0x3a0e, 0x03},
 	{0x3a0d, 0x04},
 	{0x3a14, 0x03},
 	{0x3a15, 0xd8},
+	{0x4001, 0x02},
 	{0x4004, 0x02},
-	       
+	{0x3000, 0x00},
+	{0x3002, 0x1c},
+	{0x3004, 0xff},
+	{0x3006, 0xc3},
+	{0x300e, 0x58},
+	{0x302e, 0x00},
+	{0x4300, 0x31},
+	{0x501f, 0x00},
 	{0x4713, 0x03},
 	{0x4407, 0x04},
+	{0x440e, 0x00},
 	{0x460b, 0x35},
-	{0x460c, 0x22},//22 //20 wan
+	{0x460c, 0x22},
+	{0x4837, 0x22},
 	{0x3824, 0x02},
-	    
+	{0x5000, 0xa7},
 	{0x5001, 0xa3},
-	{0x3035, 0x21},  //0x21
-	
-	{0x3820, 0x41}, // #3 ck. origin: 0x47,
-	{0x3821, 0x07}, // #3 ck. origin: 0x01, 
-	{0x3031, 0x08},   
+	{0x5025, 0x00},
+	{0x3a0f, 0x30},
+	{0x3a10, 0x28},
+	{0x3a1b, 0x30},
+	{0x3a1e, 0x26},
+	{0x3a11, 0x60},
+	{0x3a1f, 0x14},
+	{0x3a19, 0xe0},
+	#endif
+
 	{0xffff, 0xff}
 };
 
@@ -3901,8 +3971,10 @@ static int ov5640_open(struct file *file)
 	//int i = 0;
 #if CONFIG_CMA
     retval = vm_init_buf(32*SZ_1M);
-    if(retval <0)
+    if(retval <0) {
+    	printk("error: no cma memory\n");
         return -1;
+    }
 #endif
 	mutex_lock(&firmware_mutex);
 	ov5640_have_opened=1;
-- 
2.19.0

