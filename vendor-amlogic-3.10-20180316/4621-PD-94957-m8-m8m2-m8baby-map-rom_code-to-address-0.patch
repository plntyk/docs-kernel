From d2856f85b1f15f1134c298fed6fd32d26700d983 Mon Sep 17 00:00:00 2001
From: "qiufang.dai" <qiufang.dai@amlogic.com>
Date: Mon, 28 Jul 2014 17:16:09 +0800
Subject: [PATCH 4621/5965] PD #94957: m8/m8m2/m8baby: map rom_code to address
 0

---
 arch/arm/boot/dts/amlogic/meson8_ZeBu.dtd          |  3 ++-
 arch/arm/boot/dts/amlogic/meson8_k100_1G.dtd       |  5 +++--
 arch/arm/boot/dts/amlogic/meson8_k100_2G.dtd       |  5 +++--
 arch/arm/boot/dts/amlogic/meson8_k101_1G.dtd       |  5 +++--
 arch/arm/boot/dts/amlogic/meson8_k101_512M.dtd     |  5 +++--
 arch/arm/boot/dts/amlogic/meson8_k102_v1.dtd       |  7 ++++---
 arch/arm/boot/dts/amlogic/meson8_k150_v1.dtd       |  5 +++--
 arch/arm/boot/dts/amlogic/meson8_k160_v1.dtd       |  5 +++--
 arch/arm/boot/dts/amlogic/meson8_k200a_1G.dtd      |  5 +++--
 arch/arm/boot/dts/amlogic/meson8_k200a_2G.dtd      |  5 +++--
 arch/arm/boot/dts/amlogic/meson8_k200a_2G_4k2k.dtd |  5 +++--
 .../boot/dts/amlogic/meson8_k200a_2G_hdmiin.dtd    |  5 +++--
 .../boot/dts/amlogic/meson8_k200b_1G_emmc_sdhc.dtd |  5 +++--
 .../boot/dts/amlogic/meson8_k200b_1G_emmc_sdio.dtd |  5 +++--
 arch/arm/boot/dts/amlogic/meson8_k200b_2G.dtd      |  5 +++--
 arch/arm/boot/dts/amlogic/meson8_k200b_2G_4k2k.dtd |  5 +++--
 .../boot/dts/amlogic/meson8_k200b_2G_hdmiin.dtd    |  5 +++--
 arch/arm/boot/dts/amlogic/meson8_pxp.dtd           |  5 +++--
 arch/arm/boot/dts/amlogic/meson8_skt.dtd           |  5 +++--
 arch/arm/boot/dts/amlogic/meson8b_m100_1G.dtd      |  5 +++--
 arch/arm/boot/dts/amlogic/meson8b_m101_512M.dtd    |  5 +++--
 arch/arm/boot/dts/amlogic/meson8b_m102_1G.dtd      |  5 +++--
 arch/arm/boot/dts/amlogic/meson8b_m200_1G.dtd      |  5 +++--
 arch/arm/boot/dts/amlogic/meson8b_m201_1G.dtd      |  5 +++--
 arch/arm/boot/dts/amlogic/meson8b_m202_512M.dtd    |  5 +++--
 arch/arm/boot/dts/amlogic/meson8b_pxp.dtd          |  5 +++--
 arch/arm/boot/dts/amlogic/meson8b_skt.dtd          |  5 +++--
 arch/arm/boot/dts/amlogic/meson8m2_n100_1G.dtd     |  5 +++--
 arch/arm/boot/dts/amlogic/meson8m2_n101_512M.dtd   |  5 +++--
 arch/arm/boot/dts/amlogic/meson8m2_n200_2G.dtd     |  5 +++--
 arch/arm/boot/dts/amlogic/meson8m2_pxp.dtd         |  5 +++--
 arch/arm/boot/dts/amlogic/meson8m2_skt.dtd         |  5 +++--
 arch/arm/mach-meson8/Makefile.boot                 |  6 +++---
 arch/arm/mach-meson8/board-meson8-common.c         |  4 ++--
 arch/arm/mach-meson8/clock.c                       | 12 ++++++++++++
 arch/arm/mach-meson8/include/mach/cpu.h            |  1 +
 arch/arm/mach-meson8/include/mach/memory.h         |  2 +-
 arch/arm/mach-meson8/smp.c                         | 14 +++++++++++---
 arch/arm/mach-meson8b/Makefile.boot                |  6 +++---
 arch/arm/mach-meson8b/board-meson8b-common.c       |  4 ++--
 arch/arm/mach-meson8b/clock.c                      | 12 ++++++++++++
 arch/arm/mach-meson8b/include/mach/cpu.h           |  1 +
 arch/arm/mach-meson8b/include/mach/memory.h        |  2 +-
 arch/arm/mach-meson8b/smp.c                        | 14 +++++++++++---
 44 files changed, 156 insertions(+), 82 deletions(-)
 mode change 100644 => 100755 arch/arm/mach-meson8b/board-meson8b-common.c
 mode change 100644 => 100755 arch/arm/mach-meson8b/include/mach/cpu.h
 mode change 100644 => 100755 arch/arm/mach-meson8b/include/mach/memory.h

diff --git a/arch/arm/boot/dts/amlogic/meson8_ZeBu.dtd b/arch/arm/boot/dts/amlogic/meson8_ZeBu.dtd
index 35856694f9f5..c822d88a891e 100755
--- a/arch/arm/boot/dts/amlogic/meson8_ZeBu.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8_ZeBu.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,7 +79,7 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x05000000>; /**reserved memory start */
 		aml_reserved_end = <0x1a5fffff>;/**reserved memory end */
-		linux,usable-memory = <0x00000000 0x04000000 0x1a600000 0x65a00000>;
+		linux,usable-memory = <0x00200000 0x04000000 0x1a600000 0x65a00000>;
 	};
 /// ***************************************************************************************
 ///	-	GIC
diff --git a/arch/arm/boot/dts/amlogic/meson8_k100_1G.dtd b/arch/arm/boot/dts/amlogic/meson8_k100_1G.dtd
index f177302e228b..cdf8c96a906a 100755
--- a/arch/arm/boot/dts/amlogic/meson8_k100_1G.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8_k100_1G.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end */
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x40000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x3fe00000>;
 
         #address-cells = <1>;
         #size-cells = <1>;
diff --git a/arch/arm/boot/dts/amlogic/meson8_k100_2G.dtd b/arch/arm/boot/dts/amlogic/meson8_k100_2G.dtd
index 83fdc5a859e6..2f9718764c4e 100755
--- a/arch/arm/boot/dts/amlogic/meson8_k100_2G.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8_k100_2G.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end */
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x80000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x7fe00000>;
 
         #address-cells = <1>;
         #size-cells = <1>;
diff --git a/arch/arm/boot/dts/amlogic/meson8_k101_1G.dtd b/arch/arm/boot/dts/amlogic/meson8_k101_1G.dtd
index 7739b0272b68..034e234a0949 100755
--- a/arch/arm/boot/dts/amlogic/meson8_k101_1G.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8_k101_1G.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end */
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x40000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x3fe00000>;
         #address-cells = <1>;
         #size-cells = <1>;
 
diff --git a/arch/arm/boot/dts/amlogic/meson8_k101_512M.dtd b/arch/arm/boot/dts/amlogic/meson8_k101_512M.dtd
index ba6887cc65fa..dd15900c1d1c 100755
--- a/arch/arm/boot/dts/amlogic/meson8_k101_512M.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8_k101_512M.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end */
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x20000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x1fe00000>;
 
         #address-cells = <1>;
         #size-cells = <1>;
diff --git a/arch/arm/boot/dts/amlogic/meson8_k102_v1.dtd b/arch/arm/boot/dts/amlogic/meson8_k102_v1.dtd
index 94f128b050c2..aa1386ab763b 100755
--- a/arch/arm/boot/dts/amlogic/meson8_k102_v1.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8_k102_v1.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end */
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x40000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x3fe00000>;
 
         #address-cells = <1>;
         #size-cells = <1>;
@@ -2428,4 +2429,4 @@ lcd_LD070WX4:lcd_LD070WX4{
 		};
 	};
 
-}; /* end of / */
\ No newline at end of file
+}; /* end of / */
diff --git a/arch/arm/boot/dts/amlogic/meson8_k150_v1.dtd b/arch/arm/boot/dts/amlogic/meson8_k150_v1.dtd
index 6162999b5086..2b09a0954c08 100755
--- a/arch/arm/boot/dts/amlogic/meson8_k150_v1.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8_k150_v1.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end */
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x40000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x3fe00000>;
         #address-cells = <1>;
         #size-cells = <1>;
 
diff --git a/arch/arm/boot/dts/amlogic/meson8_k160_v1.dtd b/arch/arm/boot/dts/amlogic/meson8_k160_v1.dtd
index c968e332534b..1e9d3d413c0e 100755
--- a/arch/arm/boot/dts/amlogic/meson8_k160_v1.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8_k160_v1.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end */
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x40000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x3fe00000>;
         #address-cells = <1>;
         #size-cells = <1>;
 
diff --git a/arch/arm/boot/dts/amlogic/meson8_k200a_1G.dtd b/arch/arm/boot/dts/amlogic/meson8_k200a_1G.dtd
index 16fbc470afa1..8b3f2f7c2925 100755
--- a/arch/arm/boot/dts/amlogic/meson8_k200a_1G.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8_k200a_1G.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -81,8 +82,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */ //reverved 96M
 		aml_reserved_end = <0x05000000>;/**reserved memory end */
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x40000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x3fe00000>;
 
 //$$ DEVICE="mem_4k2k_decoder"
 //$$ L3 PROP_U32 2 ="reg" 
diff --git a/arch/arm/boot/dts/amlogic/meson8_k200a_2G.dtd b/arch/arm/boot/dts/amlogic/meson8_k200a_2G.dtd
index 486e24bd98b7..895ccf328165 100755
--- a/arch/arm/boot/dts/amlogic/meson8_k200a_2G.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8_k200a_2G.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end */
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x80000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x7fe00000>;
 
         #address-cells = <1>;
         #size-cells = <1>;
diff --git a/arch/arm/boot/dts/amlogic/meson8_k200a_2G_4k2k.dtd b/arch/arm/boot/dts/amlogic/meson8_k200a_2G_4k2k.dtd
index 939806563fa9..7091145cd8f8 100755
--- a/arch/arm/boot/dts/amlogic/meson8_k200a_2G_4k2k.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8_k200a_2G_4k2k.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end */
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x80000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x7fe00000>;
 
         #address-cells = <1>;
         #size-cells = <1>;
diff --git a/arch/arm/boot/dts/amlogic/meson8_k200a_2G_hdmiin.dtd b/arch/arm/boot/dts/amlogic/meson8_k200a_2G_hdmiin.dtd
index 986dd1d16525..75407d5d7b15 100755
--- a/arch/arm/boot/dts/amlogic/meson8_k200a_2G_hdmiin.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8_k200a_2G_hdmiin.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end */
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x80000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x7fe00000>;
 
         #address-cells = <1>;
         #size-cells = <1>;
diff --git a/arch/arm/boot/dts/amlogic/meson8_k200b_1G_emmc_sdhc.dtd b/arch/arm/boot/dts/amlogic/meson8_k200b_1G_emmc_sdhc.dtd
index 14b764f4fa97..66b55e950708 100755
--- a/arch/arm/boot/dts/amlogic/meson8_k200b_1G_emmc_sdhc.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8_k200b_1G_emmc_sdhc.dtd
@@ -52,6 +52,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -82,8 +83,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */ //reverved 96M
 		aml_reserved_end = <0x05000000>;/**reserved memory end */
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x40000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x3fe00000>;
 
 //$$ DEVICE="mem_4k2k_decoder"
 //$$ L3 PROP_U32 2 ="reg" 
diff --git a/arch/arm/boot/dts/amlogic/meson8_k200b_1G_emmc_sdio.dtd b/arch/arm/boot/dts/amlogic/meson8_k200b_1G_emmc_sdio.dtd
index d0eea68adf4a..6a87db1c9bfb 100755
--- a/arch/arm/boot/dts/amlogic/meson8_k200b_1G_emmc_sdio.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8_k200b_1G_emmc_sdio.dtd
@@ -52,6 +52,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -82,8 +83,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */ //reverved 96M
 		aml_reserved_end = <0x05000000>;/**reserved memory end */
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x40000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x3fe00000>;
 
 //$$ DEVICE="mem_4k2k_decoder"
 //$$ L3 PROP_U32 2 ="reg" 
diff --git a/arch/arm/boot/dts/amlogic/meson8_k200b_2G.dtd b/arch/arm/boot/dts/amlogic/meson8_k200b_2G.dtd
index e4dde379bd65..f57e7a4dbb0c 100755
--- a/arch/arm/boot/dts/amlogic/meson8_k200b_2G.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8_k200b_2G.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end */
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x80000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x7fe00000>;
 
         #address-cells = <1>;
         #size-cells = <1>;
diff --git a/arch/arm/boot/dts/amlogic/meson8_k200b_2G_4k2k.dtd b/arch/arm/boot/dts/amlogic/meson8_k200b_2G_4k2k.dtd
index 27595f6ba986..089d21362731 100755
--- a/arch/arm/boot/dts/amlogic/meson8_k200b_2G_4k2k.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8_k200b_2G_4k2k.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end */
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x80000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x7fe00000>;
 
         #address-cells = <1>;
         #size-cells = <1>;
diff --git a/arch/arm/boot/dts/amlogic/meson8_k200b_2G_hdmiin.dtd b/arch/arm/boot/dts/amlogic/meson8_k200b_2G_hdmiin.dtd
index c33287ec6785..38cbab6a03fd 100755
--- a/arch/arm/boot/dts/amlogic/meson8_k200b_2G_hdmiin.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8_k200b_2G_hdmiin.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end */
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x80000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x7fe00000>;
 
         #address-cells = <1>;
         #size-cells = <1>;
diff --git a/arch/arm/boot/dts/amlogic/meson8_pxp.dtd b/arch/arm/boot/dts/amlogic/meson8_pxp.dtd
index db2896fb2505..3c112c2a8f25 100755
--- a/arch/arm/boot/dts/amlogic/meson8_pxp.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8_pxp.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end : dtb start for uboot*/
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x80000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x7fe00000>;
 		
 		#address-cells = <1>;
     #size-cells = <1>;
diff --git a/arch/arm/boot/dts/amlogic/meson8_skt.dtd b/arch/arm/boot/dts/amlogic/meson8_skt.dtd
index 3d42ac4430c1..52e46af7d40e 100755
--- a/arch/arm/boot/dts/amlogic/meson8_skt.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8_skt.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end : dtb start for uboot*/
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x80000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x7fe00000>;
 
         #address-cells = <1>;
         #size-cells = <1>;
diff --git a/arch/arm/boot/dts/amlogic/meson8b_m100_1G.dtd b/arch/arm/boot/dts/amlogic/meson8b_m100_1G.dtd
index 3cd1347e9c8d..3be9161e8ab9 100755
--- a/arch/arm/boot/dts/amlogic/meson8b_m100_1G.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8b_m100_1G.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end : dtb start for uboot*/
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x40000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x3fe00000>;
         #address-cells = <1>;
         #size-cells = <1>;
 
diff --git a/arch/arm/boot/dts/amlogic/meson8b_m101_512M.dtd b/arch/arm/boot/dts/amlogic/meson8b_m101_512M.dtd
index bab9121eba4a..bbef988acc6c 100755
--- a/arch/arm/boot/dts/amlogic/meson8b_m101_512M.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8b_m101_512M.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end */
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x20000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x1fe00000>;
 
         #address-cells = <1>;
         #size-cells = <1>;
diff --git a/arch/arm/boot/dts/amlogic/meson8b_m102_1G.dtd b/arch/arm/boot/dts/amlogic/meson8b_m102_1G.dtd
index 4e385fcc795b..b0241adadf00 100755
--- a/arch/arm/boot/dts/amlogic/meson8b_m102_1G.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8b_m102_1G.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end */
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x40000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x3fe00000>;
 
         #address-cells = <1>;
         #size-cells = <1>;
diff --git a/arch/arm/boot/dts/amlogic/meson8b_m200_1G.dtd b/arch/arm/boot/dts/amlogic/meson8b_m200_1G.dtd
index e8e9931bd3e4..057c8edd9a8f 100755
--- a/arch/arm/boot/dts/amlogic/meson8b_m200_1G.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8b_m200_1G.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end : dtb start for uboot*/
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x40000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x3fe00000>;
         #address-cells = <1>;
         #size-cells = <1>;
 
diff --git a/arch/arm/boot/dts/amlogic/meson8b_m201_1G.dtd b/arch/arm/boot/dts/amlogic/meson8b_m201_1G.dtd
index 7cc1ceaabbc4..8acfd151e711 100755
--- a/arch/arm/boot/dts/amlogic/meson8b_m201_1G.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8b_m201_1G.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end : dtb start for uboot*/
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x40000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x3fe00000>;
         #address-cells = <1>;
         #size-cells = <1>;
 
diff --git a/arch/arm/boot/dts/amlogic/meson8b_m202_512M.dtd b/arch/arm/boot/dts/amlogic/meson8b_m202_512M.dtd
index fe0ce5a758de..7822822189f8 100755
--- a/arch/arm/boot/dts/amlogic/meson8b_m202_512M.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8b_m202_512M.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end */
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x20000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x1fe00000>;
 
         #address-cells = <1>;
         #size-cells = <1>;
diff --git a/arch/arm/boot/dts/amlogic/meson8b_pxp.dtd b/arch/arm/boot/dts/amlogic/meson8b_pxp.dtd
index 80073a98f48f..5497ae1701f2 100755
--- a/arch/arm/boot/dts/amlogic/meson8b_pxp.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8b_pxp.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end : dtb start for uboot*/
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x80000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x7fe00000>;
         #address-cells = <1>;
         #size-cells = <1>;
 
diff --git a/arch/arm/boot/dts/amlogic/meson8b_skt.dtd b/arch/arm/boot/dts/amlogic/meson8b_skt.dtd
index c2d122ce5b3c..074a09057c25 100755
--- a/arch/arm/boot/dts/amlogic/meson8b_skt.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8b_skt.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end : dtb start for uboot*/
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x40000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x3fe00000>;
         #address-cells = <1>;
         #size-cells = <1>;
 
diff --git a/arch/arm/boot/dts/amlogic/meson8m2_n100_1G.dtd b/arch/arm/boot/dts/amlogic/meson8m2_n100_1G.dtd
index c8521e556a75..a05fe3b433dc 100755
--- a/arch/arm/boot/dts/amlogic/meson8m2_n100_1G.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8m2_n100_1G.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end */
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x40000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x3fe00000>;
 
         #address-cells = <1>;
         #size-cells = <1>;
diff --git a/arch/arm/boot/dts/amlogic/meson8m2_n101_512M.dtd b/arch/arm/boot/dts/amlogic/meson8m2_n101_512M.dtd
index 711a6fa395c9..39ba4eac51d2 100755
--- a/arch/arm/boot/dts/amlogic/meson8m2_n101_512M.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8m2_n101_512M.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end */
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x20000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x1fe00000>;
 
         #address-cells = <1>;
         #size-cells = <1>;
diff --git a/arch/arm/boot/dts/amlogic/meson8m2_n200_2G.dtd b/arch/arm/boot/dts/amlogic/meson8m2_n200_2G.dtd
index 5f2cf9d0b5f2..d431446b0075 100755
--- a/arch/arm/boot/dts/amlogic/meson8m2_n200_2G.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8m2_n200_2G.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end */
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x80000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x7fe00000>;
 
         #address-cells = <1>;
         #size-cells = <1>;
diff --git a/arch/arm/boot/dts/amlogic/meson8m2_pxp.dtd b/arch/arm/boot/dts/amlogic/meson8m2_pxp.dtd
index f9c331219d32..cf94734327f7 100755
--- a/arch/arm/boot/dts/amlogic/meson8m2_pxp.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8m2_pxp.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end : dtb start for uboot*/
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x40000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x3fe00000>;
 
         #address-cells = <1>;
         #size-cells = <1>;
diff --git a/arch/arm/boot/dts/amlogic/meson8m2_skt.dtd b/arch/arm/boot/dts/amlogic/meson8m2_skt.dtd
index 3c24bd8c201e..43b9029c45ff 100755
--- a/arch/arm/boot/dts/amlogic/meson8m2_skt.dtd
+++ b/arch/arm/boot/dts/amlogic/meson8m2_skt.dtd
@@ -51,6 +51,7 @@ void root_func(){
           reg = <0xc4200000 0x1000>;
           arm,data-latency = <3 3 3>;
           arm,tag-latency = <2 2 2>;
+          arm,filter-ranges = <0x100000 0xc0000000>;
           cache-unified;
           cache-level = <2>;
           aux-instruction_prefetch;
@@ -78,8 +79,8 @@ void root_func(){
 		device_type = "memory";
 		aml_reserved_start = <0x06000000>; /**reserved memory start */
 		aml_reserved_end = <0x05000000>;/**reserved memory end : dtb start for uboot*/
-		phys_offset = <0x00000000>;
-		linux,total-memory = <0x80000000>;
+		phys_offset = <0x00200000>;
+		linux,total-memory = <0x7fe00000>;
 
         #address-cells = <1>;
         #size-cells = <1>;
diff --git a/arch/arm/mach-meson8/Makefile.boot b/arch/arm/mach-meson8/Makefile.boot
index c7e75acfe6c9..b0d7776f6273 100755
--- a/arch/arm/mach-meson8/Makefile.boot
+++ b/arch/arm/mach-meson8/Makefile.boot
@@ -1,4 +1,4 @@
-   zreladdr-y	:= 0x00008000
-params_phys-y	:= 0x00000100
-initrd_phys-y	:= 0x00800000
+   zreladdr-y	:= 0x00208000
+params_phys-y	:= 0x00200100
+initrd_phys-y	:= 0x00a00000
 
diff --git a/arch/arm/mach-meson8/board-meson8-common.c b/arch/arm/mach-meson8/board-meson8-common.c
index 693bb7478b6f..9b4bb2ea19b8 100755
--- a/arch/arm/mach-meson8/board-meson8-common.c
+++ b/arch/arm/mach-meson8/board-meson8-common.c
@@ -56,7 +56,7 @@ static void meson_map_board_io(void);
 extern unsigned long long aml_reserved_start;
 extern unsigned long long aml_reserved_end;
 extern void __init meson_timer_init(void);
-void backup_cpu_entry_code(void);
+//void backup_cpu_entry_code(void);
 
 static __init void meson8_reserve(void)
 {
@@ -134,7 +134,7 @@ static __init void meson_init_early(void)
 static void __init meson_init_irq(void)
 {
 	meson_init_gic_irq();
-	backup_cpu_entry_code();
+//	backup_cpu_entry_code();
 }
 static const char *m8_common_board_compat[] __initdata = {
 	"AMLOGIC,8726_M8",
diff --git a/arch/arm/mach-meson8/clock.c b/arch/arm/mach-meson8/clock.c
index dd4da32bc89e..cbd81cd9fb6f 100755
--- a/arch/arm/mach-meson8/clock.c
+++ b/arch/arm/mach-meson8/clock.c
@@ -914,6 +914,18 @@ void meson_set_cpu_ctrl_addr(uint32_t cpu, const uint32_t addr)
 	spin_unlock(&clockfw_lock);	
 }
 
+int meson_get_cpu_ctrl_addr(int cpu)
+{
+
+#ifdef CONFIG_MESON_TRUSTZONE
+//	meson_auxcoreboot_addr(cpu, addr);
+#else
+//printk("sram=0x%x addr=0x%x\n",(MESON_CPU1_CONTROL_ADDR_REG + ((cpu-1) << 2)),addr);
+	return aml_read_reg32(MESON_CPU1_CONTROL_ADDR_REG + ((cpu-1) << 2));
+#endif
+
+}
+
 static inline unsigned long meson_smp_wait_others(unsigned status)
 {
 	unsigned long count = 0;
diff --git a/arch/arm/mach-meson8/include/mach/cpu.h b/arch/arm/mach-meson8/include/mach/cpu.h
index cefa42213d84..e2b4782763b8 100755
--- a/arch/arm/mach-meson8/include/mach/cpu.h
+++ b/arch/arm/mach-meson8/include/mach/cpu.h
@@ -31,6 +31,7 @@ extern void meson_cpu_die(unsigned int cpu);
 extern int meson_cpu_disable(unsigned int cpu);
 extern void meson_secondary_startup(void);
 extern void meson_set_cpu_ctrl_reg(int cpu,int is_on);
+extern int meson_get_cpu_ctrl_addr(int cpu);
 extern void meson_set_cpu_ctrl_addr(uint32_t cpu, const uint32_t addr);
 extern void meson_set_cpu_power_ctrl(uint32_t cpu,int is_power_on);
 
diff --git a/arch/arm/mach-meson8/include/mach/memory.h b/arch/arm/mach-meson8/include/mach/memory.h
index 84ac9227dbd1..08b27e17cedb 100755
--- a/arch/arm/mach-meson8/include/mach/memory.h
+++ b/arch/arm/mach-meson8/include/mach/memory.h
@@ -23,7 +23,7 @@
 /*
  * Physical DRAM offset.
  */
-#define PHYS_OFFSET     UL(0x00000000)
+#define PHYS_OFFSET     UL(0x00200000)
 
 #define BOOT_PARAMS_OFFSET  (PHYS_OFFSET + 0x100)
 
diff --git a/arch/arm/mach-meson8/smp.c b/arch/arm/mach-meson8/smp.c
index 12df1bd4ebdc..a9fb418c821e 100755
--- a/arch/arm/mach-meson8/smp.c
+++ b/arch/arm/mach-meson8/smp.c
@@ -28,7 +28,7 @@
 #include <linux/percpu.h>
 
 static DEFINE_SPINLOCK(boot_lock);
-
+#if 0
 static unsigned int cpu_entry_code[16];
 /*
  * Write pen_release in a way that is guaranteed to be visible to all
@@ -66,7 +66,7 @@ static void check_and_rewrite_cpu_entry(void)
 		outer_clean_range(__pa(p), __pa(p+count));
 	}
 }
-
+#endif
 static void write_pen_release(int val)
 {
 	pen_release = val;
@@ -131,9 +131,17 @@ int __cpuinit meson_boot_secondary(unsigned int cpu, struct task_struct *idle)
 	write_pen_release(cpu_logical_map(cpu));
 
 #ifndef CONFIG_MESON_TRUSTZONE
-	check_and_rewrite_cpu_entry();
+//	check_and_rewrite_cpu_entry();
+	meson_secondary_set(cpu);
 	meson_set_cpu_power_ctrl(cpu, 1);
 #endif
+	timeout = jiffies + (10* HZ);
+	while(meson_get_cpu_ctrl_addr(cpu));
+	{
+		if(!time_before(jiffies, timeout))
+			return -EPERM;
+	}
+
 	meson_secondary_set(cpu);
 	dsb_sev();
 
diff --git a/arch/arm/mach-meson8b/Makefile.boot b/arch/arm/mach-meson8b/Makefile.boot
index c7e75acfe6c9..b0d7776f6273 100644
--- a/arch/arm/mach-meson8b/Makefile.boot
+++ b/arch/arm/mach-meson8b/Makefile.boot
@@ -1,4 +1,4 @@
-   zreladdr-y	:= 0x00008000
-params_phys-y	:= 0x00000100
-initrd_phys-y	:= 0x00800000
+   zreladdr-y	:= 0x00208000
+params_phys-y	:= 0x00200100
+initrd_phys-y	:= 0x00a00000
 
diff --git a/arch/arm/mach-meson8b/board-meson8b-common.c b/arch/arm/mach-meson8b/board-meson8b-common.c
old mode 100644
new mode 100755
index dce50a8e0f4e..e4a120b05d06
--- a/arch/arm/mach-meson8b/board-meson8b-common.c
+++ b/arch/arm/mach-meson8b/board-meson8b-common.c
@@ -51,7 +51,7 @@ static void meson_map_board_io(void);
 extern unsigned long long aml_reserved_start;
 extern unsigned long long aml_reserved_end;
 extern void __init meson_timer_init(void);
-void backup_cpu_entry_code(void);
+//void backup_cpu_entry_code(void);
 
 static __init void meson8b_reserve(void)
 {
@@ -125,7 +125,7 @@ static __init void meson_init_early(void)
 static void __init meson_init_irq(void)
 {
 	meson_init_gic_irq();
-	backup_cpu_entry_code();
+//	backup_cpu_entry_code();
 }
 static const char *m8_common_board_compat[] __initdata = {
 	"AMLOGIC,8726_M8B",
diff --git a/arch/arm/mach-meson8b/clock.c b/arch/arm/mach-meson8b/clock.c
index e368febbe3d8..81711445a8d1 100755
--- a/arch/arm/mach-meson8b/clock.c
+++ b/arch/arm/mach-meson8b/clock.c
@@ -929,6 +929,18 @@ void meson_set_cpu_ctrl_addr(uint32_t cpu, const uint32_t addr)
 	spin_unlock(&clockfw_lock);	
 }
 
+int meson_get_cpu_ctrl_addr(int cpu)
+{
+
+#ifdef CONFIG_MESON_TRUSTZONE
+//	meson_auxcoreboot_addr(cpu, addr);
+#else
+//printk("sram=0x%x addr=0x%x\n",(MESON_CPU1_CONTROL_ADDR_REG + ((cpu-1) << 2)),addr);
+	return aml_read_reg32(MESON_CPU1_CONTROL_ADDR_REG + ((cpu-1) << 2));
+#endif
+
+}
+
 static inline unsigned long meson_smp_wait_others(unsigned status)
 {
 	unsigned long count = 0;
diff --git a/arch/arm/mach-meson8b/include/mach/cpu.h b/arch/arm/mach-meson8b/include/mach/cpu.h
old mode 100644
new mode 100755
index ed061f738d5a..0b3496ae51e8
--- a/arch/arm/mach-meson8b/include/mach/cpu.h
+++ b/arch/arm/mach-meson8b/include/mach/cpu.h
@@ -27,6 +27,7 @@ extern void meson_cpu_die(unsigned int cpu);
 extern int meson_cpu_disable(unsigned int cpu);
 extern void meson_secondary_startup(void);
 extern void meson_set_cpu_ctrl_reg(int cpu,int is_on);
+extern int meson_get_cpu_ctrl_addr(int cpu);
 extern void meson_set_cpu_ctrl_addr(uint32_t cpu, const uint32_t addr);
 extern void meson_set_cpu_power_ctrl(uint32_t cpu,int is_power_on);
 
diff --git a/arch/arm/mach-meson8b/include/mach/memory.h b/arch/arm/mach-meson8b/include/mach/memory.h
old mode 100644
new mode 100755
index 84ac9227dbd1..08b27e17cedb
--- a/arch/arm/mach-meson8b/include/mach/memory.h
+++ b/arch/arm/mach-meson8b/include/mach/memory.h
@@ -23,7 +23,7 @@
 /*
  * Physical DRAM offset.
  */
-#define PHYS_OFFSET     UL(0x00000000)
+#define PHYS_OFFSET     UL(0x00200000)
 
 #define BOOT_PARAMS_OFFSET  (PHYS_OFFSET + 0x100)
 
diff --git a/arch/arm/mach-meson8b/smp.c b/arch/arm/mach-meson8b/smp.c
index c26d6bd2674a..9c4db418c366 100755
--- a/arch/arm/mach-meson8b/smp.c
+++ b/arch/arm/mach-meson8b/smp.c
@@ -28,7 +28,7 @@
 #include <linux/percpu.h>
 
 static DEFINE_SPINLOCK(boot_lock);
-
+#if 0
 static unsigned int cpu_entry_code[16];
 /*
  * Write pen_release in a way that is guaranteed to be visible to all
@@ -66,7 +66,7 @@ static void check_and_rewrite_cpu_entry(void)
 		outer_clean_range(__pa(p), __pa(p+count));
 	}
 }
-
+#endif
 static void write_pen_release(int val)
 {
 	pen_release = val;
@@ -131,9 +131,17 @@ int __cpuinit meson_boot_secondary(unsigned int cpu, struct task_struct *idle)
 	write_pen_release(cpu_logical_map(cpu));
 
 #ifndef CONFIG_MESON_TRUSTZONE
-	check_and_rewrite_cpu_entry();
+//	check_and_rewrite_cpu_entry();
+	meson_secondary_set(cpu);
 	meson_set_cpu_power_ctrl(cpu, 1);
 #endif
+	timeout = jiffies + (10* HZ);
+	while(meson_get_cpu_ctrl_addr(cpu));
+	{
+		if(!time_before(jiffies, timeout))
+			return -EPERM;
+	}
+
 	meson_secondary_set(cpu);
 	dsb_sev();
 
-- 
2.19.0

