From 0b5af9f17990b1d2d20e3ae674878de58d19c267 Mon Sep 17 00:00:00 2001
From: "jian.xu" <jian.xu@amlogic.com>
Date: Wed, 3 Sep 2014 18:30:32 +0800
Subject: [PATCH 4824/5965] PD#97119 :fix CVE-2013-6763 ,Fix a few incorrectly
 checked [io_]remap_pfn_range() calls   when mapping size smaller than mmap
 calls size

Change-Id: Ie1bec830f096d0e8727044af89a5c3a61ad490dd
---
 drivers/amlogic/amports/adec.c | 16 +++++++++++-----
 1 file changed, 11 insertions(+), 5 deletions(-)

diff --git a/drivers/amlogic/amports/adec.c b/drivers/amlogic/amports/adec.c
index f7fcf4101c14..2851adc58077 100755
--- a/drivers/amlogic/amports/adec.c
+++ b/drivers/amlogic/amports/adec.c
@@ -154,25 +154,31 @@ static struct uio_info astream_uio_info = {
             .name = "AIFIFO",			
             .memtype = UIO_MEM_PHYS,
             .addr = (IO_CBUS_PHY_BASE + CBUS_REG_OFFSET(AIU_AIFIFO_CTRL)),
-            .size = (AIU_MEM_AIFIFO_LEVEL - AIU_AIFIFO_CTRL + 1) * 4,
+            .size = PAGE_SIZE,
         },
         [1] = {
             .memtype = UIO_MEM_PHYS,
             .addr = (IO_CBUS_PHY_BASE + CBUS_REG_OFFSET(VCOP_CTRL_REG)),
-            .size = (VC1_BITPLANE_CTL - VCOP_CTRL_REG + 1)*4,
+            .size = PAGE_SIZE,
         },
         [2] = {
             .name = "SECBUS",
             .memtype = UIO_MEM_PHYS,
             .addr = (IO_SECBUS_PHY_BASE ),
-            .size = (EFUSE_CNTL4 - EFUSE_CNTL0 + 1)*4,
+            .size = PAGE_SIZE,
         },  
         [3] = {
             .name = "CBUS",
             .memtype = UIO_MEM_PHYS,
             .addr = (IO_CBUS_PHY_BASE+ CBUS_REG_OFFSET(ASSIST_HW_REV)),
-            .size = (4 - 0 + 1)*4,
-        },           
+            .size = PAGE_SIZE,
+        },  
+        [4] = {
+            .name = "CBUS-START",
+            .memtype = UIO_MEM_PHYS,
+            .addr = (IO_CBUS_PHY_BASE+ CBUS_REG_OFFSET(0x1000)),
+            .size = PAGE_SIZE*4,
+        },                  
     },
 };
 #endif
-- 
2.19.0

